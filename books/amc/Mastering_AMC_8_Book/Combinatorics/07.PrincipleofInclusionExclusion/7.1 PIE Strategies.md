# 7.1 포함-배제 원리 전략 (PIE Strategies)

## 1. 개요 (Overview)

포함-배제 원리(Principle of Inclusion-Exclusion, PIE)는 여러 집합의 합집합(Union)의 원소 개수를 셀 때, **중복되어 세어진 부분을 보정**하는 기법입니다. 단순히 집합의 크기를 더하면 교집합 부분이 중복 계산되므로, 이를 빼주고(Exclusion), 너무 많이 뺐으면 다시 더해주는(Inclusion) 과정을 반복합니다.

## 2. 공식 및 원리 (Formulas & Principles)

### 2.1 두 집합의 PIE (Two Sets)

두 집합 $A, B$에 대하여, 적어도 한 집합에 속하는 원소의 개수는 다음과 같습니다.
$$ n(A \cup B) = n(A) + n(B) - n(A \cap B) $$

- **전략:** 두 집합을 더하면 교집합($A \cap B$)이 두 번 세어지므로, 한 번 빼줍니다.

### 2.2 세 집합의 PIE (Three Sets)

세 집합 $A, B, C$에 대하여:
$$ n(A \cup B \cup C) = n(A) + n(B) + n(C) - \{n(A \cap B) + n(A \cap C) + n(B \cap C)\} + n(A \cap B \cap C) $$

- **전략:**
  1.  **더하기:** 각 집합의 크기를 더합니다. (교집합들이 중복됨)
  2.  **빼기:** 두 집합 간의 교집합을 뺍니다. (세 집합의 교집합이 너무 많이 빠짐)
  3.  **더하기:** 세 집합 모두의 교집합을 다시 더합니다.

## 3. 예제 (Examples)

### 예제 1: 두 과목 수강생 (Two Subjects)

학생 30명 중 수학을 좋아하는 학생이 20명, 영어를 좋아하는 학생이 15명, 둘 다 좋아하는 학생이 8명일 때, 적어도 한 과목을 좋아하는 학생 수는?

- $n(M) = 20, n(E) = 15, n(M \cap E) = 8$
- $n(M \cup E) = 20 + 15 - 8 = 27$명.
- (참고: 둘 다 싫어하는 학생은 $30 - 27 = 3$명)

### 예제 2: 배수의 개수 (Divisibility)

1부터 30까지의 정수 중 2의 배수이거나 3의 배수인 수의 개수는?

- **2의 배수($A$):** $\lfloor \frac{30}{2} \rfloor = 15$개
- **3의 배수($B$):** $\lfloor \frac{30}{3} \rfloor = 10$개
- **6의 배수($A \cap B$):** $\lfloor \frac{30}{6} \rfloor = 5$개
- **계산:** $15 + 10 - 5 = 20$개

## 4. 코드 구현 (Code Implementation)

Python의 `set` 자료형과 연산자를 사용하여 PIE 공식을 검증하는 코드입니다.

### 4.1 집합 연산을 이용한 검증

```python
def verify_pie_two_sets():
    # 예제 2: 1~30 중 2의 배수 또는 3의 배수
    universe = set(range(1, 31))

    set_A = {x for x in universe if x % 2 == 0} # 2의 배수
    set_B = {x for x in universe if x % 3 == 0} # 3의 배수

    # 1. 실제 합집합 구하기 (Python set union)
    union_set = set_A | set_B
    actual_count = len(union_set)

    # 2. PIE 공식으로 계산하기
    intersection = set_A & set_B
    pie_count = len(set_A) + len(set_B) - len(intersection)

    print(f"Set A (2의 배수): {len(set_A)}")
    print(f"Set B (3의 배수): {len(set_B)}")
    print(f"Intersection (6의 배수): {len(intersection)}")
    print(f"Union (Actual): {actual_count}")
    print(f"Union (PIE Formula): {pie_count}")

verify_pie_two_sets()
```

### 4.2 일반화된 PIE 함수 (참고용)

```python
def pie_formula_3_sets(nA, nB, nC, nAB, nAC, nBC, nABC):
    """
    세 집합의 크기와 교집합들의 크기가 주어졌을 때 합집합의 크기 반환
    """
    return nA + nB + nC - (nAB + nAC + nBC) + nABC

# 예: A=10, B=10, C=10, 교집합들은 모두 3, 전체 교집합 1
# 10+10+10 - (3+3+3) + 1 = 30 - 9 + 1 = 22
print(f"PIE 3 Sets Result: {pie_formula_3_sets(10, 10, 10, 3, 3, 3, 1)}")
```

## 5. 요약 (Summary)

- **핵심:** 더하고($+$), 뺀다($-$). (3개일 때는 다시 더한다($+$)).
- **벤 다이어그램:** 겹치는 영역이 몇 번 세어졌는지 시각적으로 확인하면 공식 유도가 쉽습니다.
- **적용:** "적어도 하나(At least one)" 또는 "또는(OR)" 조건이 있는 문제에서 강력합니다.
