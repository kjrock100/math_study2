# 20.3 지수 법칙 (Exponent Rule)

## 1. 개요 (Overview)

큰 지수가 포함된 합동식 $A^B \pmod n$을 계산하는 방법을 다룹니다. 직접 곱하는 것은 불가능하므로, **거듭제곱의 순환 패턴(Cycle)**을 찾거나 **페르마의 소정리(Fermat's Little Theorem)**와 같은 정수론의 도구를 사용하여 지수를 줄이는(Reduce) 것이 핵심입니다.

## 2. 핵심 원리 (Key Principles)

### 2.1 순환 패턴 (Cycles)

모듈러 연산에서 거듭제곱은 반드시 반복되는 패턴을 가집니다.
특히 $A^k \equiv 1 \pmod n$이 되는 최소의 $k$를 찾으면, 지수를 $k$로 나눈 나머지만 고려하면 됩니다.
$$ A^B \pmod n \equiv A^{B \pmod k} \pmod n $$
(단, $A^B$가 순환 마디 안에 들어갈 만큼 충분히 클 때, 그리고 보통 $A$와 $n$이 서로소일 때 $1$로 돌아옵니다.)

### 2.2 페르마의 소정리 (Fermat's Little Theorem)

법 $p$가 소수(Prime)이고 $A$가 $p$의 배수가 아닐 때:
$$ A^{p-1} \equiv 1 \pmod p $$
이 정리를 이용하면 지수 $B$를 $p-1$로 나눈 나머지만 계산하면 됩니다.
$$ A^B \equiv A^{B \pmod{p-1}} \pmod p $$

## 3. 예제 (Examples)

### 예제 1: 패턴 찾기

$2^{50}$을 $7$로 나눈 나머지는?

1.  거듭제곱 계산 ($\pmod 7$):
    - $2^1 \equiv 2$
    - $2^2 \equiv 4$
    - $2^3 \equiv 8 \equiv 1$ (패턴 발견! 주기 $k=3$)
2.  지수 줄이기:
    - $50 \div 3 = 16$ 나머지 $2$.
    - 즉, $50 \equiv 2 \pmod 3$.
3.  결과:
    - $2^{50} \equiv 2^2 \equiv 4 \pmod 7$.

### 예제 2: 페르마의 소정리 활용

$3^{100}$을 $5$로 나눈 나머지는?

1.  법 $5$는 소수입니다.
2.  페르마의 소정리에 의해 $3^{5-1} = 3^4 \equiv 1 \pmod 5$.
3.  지수 $100$은 $4$의 배수입니다 ($100 = 4 \times 25$).
4.  $3^{100} = (3^4)^{25} \equiv 1^{25} \equiv 1 \pmod 5$.

## 4. 코드 구현 (Code Implementation)

Python을 사용하여 거듭제곱의 주기를 찾고, 큰 수의 나머지를 계산하는 함수입니다.

```python
def find_power_cycle(base, modulus):
    """
    base^k mod modulus의 주기를 찾는 함수
    """
    history = []
    curr = base % modulus

    while curr not in history:
        history.append(curr)
        curr = (curr * base) % modulus

    # 반복 시작 지점 찾기
    start_index = history.index(curr)
    cycle = history[start_index:]
    return cycle

def solve_large_exponent(base, exponent, modulus):
    """
    base^exponent % modulus 계산
    """
    # 방법 1: Python 내장 함수 (가장 효율적)
    # return pow(base, exponent, modulus)

    # 방법 2: 주기를 이용한 직접 구현 (교육적 목적)
    cycle = find_power_cycle(base, modulus)

    # 주기가 1로 끝나는 단순한 경우 (서로소)
    # 지수를 주기 길이로 나눈 나머지 활용
    cycle_len = len(cycle)
    idx = (exponent - 1) % cycle_len
    return cycle[idx]

# 테스트
print(f"Cycle of 2 mod 7: {find_power_cycle(2, 7)}") # Expected: [2, 4, 1]
print(f"2^50 mod 7: {solve_large_exponent(2, 50, 7)}") # Expected: 4

print(f"Cycle of 3 mod 5: {find_power_cycle(3, 5)}") # Expected: [3, 4, 2, 1]
print(f"3^100 mod 5: {solve_large_exponent(3, 100, 5)}") # Expected: 1
```

## 5. 요약 (Summary)

- **지수 줄이기:** $A^k \equiv 1 \pmod n$인 $k$를 찾아 지수를 나눈다.
- **페르마의 소정리:** 소수 $p$에 대해 $A^{p-1} \equiv 1 \pmod p$.
- **효율성:** 큰 수를 직접 계산하지 않고 주기성을 이용한다.
