# 7.5 실전 문제 (Practice Problems)

## 1. 개요 (Overview)

이 장에서는 포함-배제 원리(PIE)의 모든 개념을 종합하여 실전 문제를 해결합니다. 2개 또는 3개의 집합이 얽힌 벤 다이어그램 문제부터, 정수론과 결합된 배수 개수 세기, 그리고 일반화된 PIE의 응용인 교란 순열(Derangements)까지 다양한 유형을 다룹니다.

## 2. 주요 문제 유형 (Key Problem Types)

1.  **벤 다이어그램 응용:** 과목 수강, 동아리 활동 등 겹치는 그룹의 인원수 계산.
2.  **배수 집합 (Divisibility):** 특정 범위 내에서 $n$개의 수 중 적어도 하나로 나누어떨어지는 수의 개수.
3.  **교란 순열 (Derangements):** 모자 바꿔 쓰기, 편지 봉투 넣기 등 자기 자신의 짝과 매칭되지 않는 경우의 수.
4.  **기하학적 PIE:** 겹쳐진 도형의 넓이 구하기.

## 3. 예제 문제 및 풀이 (Sample Problems & Solutions)

### 문제 1: 세 가지 과일 (Three Fruits)

학생 100명을 대상으로 조사를 했다. 사과(A) 50명, 바나나(B) 40명, 체리(C) 30명이 좋아한다.

- A&B: 15명, B&C: 10명, A&C: 10명
- A&B&C: 5명
  세 과일 중 **아무것도 좋아하지 않는(None)** 학생 수는?

- **합집합 구하기 (PIE):**
  $$ n(A \cup B \cup C) = (50+40+30) - (15+10+10) + 5 $$
    $$ = 120 - 35 + 5 = 90 $$
- **여집합 구하기:**
  $$ 100 - 90 = 10 \text{명} $$

### 문제 2: 배수의 개수 (Divisibility by 2, 3, 5)

1부터 100까지의 정수 중 2, 3, 5 중 **적어도 하나로 나누어떨어지는** 수의 개수는?

- **싱글:** $n(2)=50, n(3)=33, n(5)=20 \rightarrow \text{합 } 103$
- **페어 (LCM):** $n(6)=16, n(10)=10, n(15)=6 \rightarrow \text{합 } 32$
- **트리플 (LCM):** $n(30)=3 \rightarrow \text{합 } 3$
- **계산:** $103 - 32 + 3 = 74$개

### 문제 3: 교란 순열 (Derangement of 5 items)

5명의 학생이 자신의 모자를 던진 후 무작위로 하나씩 집었을 때, **모두 남의 모자를 집을** 경우의 수는? ($D_5$)

- **공식:** $D_5 = 5! \times (\frac{1}{0!} - \frac{1}{1!} + \frac{1}{2!} - \frac{1}{3!} + \frac{1}{4!} - \frac{1}{5!})$
- **계산:** $120 \times (1 - 1 + 0.5 - 0.166...)$
  - $D_1=0, D_2=1, D_3=2, D_4=9, D_5=44$
- **정답:** 44가지

## 4. 문제 해결 전략 (Problem Solving Strategies)

- **영역 식별:** 문제에서 묻는 것이 "적어도 하나(Union)"인지 "모두(Intersection)"인지, 아니면 "아무것도 아님(Neither)"인지 명확히 합니다.
- **LCM 활용:** 배수 문제에서 교집합은 두 수의 최소공배수(LCM)의 배수 개수와 같습니다.
- **암기 추천:** $D_4=9, D_5=44$는 자주 나오므로 외워두면 시간을 절약할 수 있습니다.

## 5. 코드 구현 (Code Implementation)

Python을 사용하여 배수 문제(PIE)와 교란 순열을 계산하는 코드입니다.

```python
import math

def solve_divisibility_pie(limit, divisors):
    """
    1부터 limit까지의 수 중 divisors의 원소로 나누어떨어지는 수의 개수 (PIE)
    """
    # 검증을 위해 Set을 이용한 Brute Force 방식 사용
    universe = set(range(1, limit + 1))
    union_set = set()

    for d in divisors:
        multiples = {x for x in universe if x % d == 0}
        union_set |= multiples # 합집합 연산

    return len(union_set)

def derangement(n):
    """
    교란 순열 D_n 계산: n! * sum((-1)^k / k!)
    또는 점화식 D_n = (n-1) * (D_{n-1} + D_{n-2}) 사용 가능
    """
    if n == 0: return 1
    if n == 1: return 0

    # 점화식 사용 (DP)
    dp = [0] * (n + 1)
    dp[0], dp[1] = 1, 0
    for i in range(2, n + 1):
        dp[i] = (i - 1) * (dp[i - 1] + dp[i - 2])

    return dp[n]

print(f"1~100 중 2,3,5의 배수 개수: {solve_divisibility_pie(100, [2, 3, 5])}") # Expected: 74
print(f"모자 5개 교란 순열 (D5): {derangement(5)}") # Expected: 44
```

## 6. 요약 (Summary)

- **PIE 공식:** 홀수 개 집합은 더하고, 짝수 개 집합은 뺀다.
- **배수 문제:** 교집합은 최소공배수(LCM)로 처리한다.
- **교란 순열:** $D_n$ 값을 미리 숙지하거나 점화식을 이해한다.
