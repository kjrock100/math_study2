# 7.3 세 사건의 포함-배제 원리 (PIE for 3 Events)

## 1. 개요 (Overview)

세 개의 집합(또는 사건) $A, B, C$가 서로 얽혀 있을 때, 이들의 합집합의 크기를 구하는 것은 두 집합일 때보다 복잡합니다. 벤 다이어그램 상에서 총 7개의 영역이 생기며, 중복 계산을 정밀하게 보정해야 합니다.

## 2. 공식 및 원리 (Formula & Logic)

### 2.1 공식

$$ n(A \cup B \cup C) = n(A) + n(B) + n(C) - \{n(A \cap B) + n(A \cap C) + n(B \cap C)\} + n(A \cap B \cap C) $$

### 2.2 논리적 유도 (Why add the last term?)

1.  **더하기 (+):** $n(A) + n(B) + n(C)$
    - 각 집합을 더합니다.
    - 두 번 겹치는 영역은 2번, 세 번 겹치는 영역(가운데)은 3번 세어집니다.
2.  **빼기 (-):** $- \{n(A \cap B) + n(A \cap C) + n(B \cap C)\}$
    - 두 번 겹치는 영역을 뺍니다.
    - 가운데 영역($A \cap B \cap C$)은 1단계에서 3번 더해지고, 2단계에서 3번 빠졌으므로, 현재 **0번** 세어진 상태가 됩니다.
3.  **다시 더하기 (+):** $+ n(A \cap B \cap C)$
    - 구멍 난 가운데 영역을 채우기 위해 마지막으로 한 번 더해줍니다.

## 3. 예제 (Examples)

### 예제 1: 악기 연주 (Musical Instruments)

학생 50명 중 피아노(P) 20명, 바이올린(V) 15명, 플루트(F) 10명이 있다.

- P&V: 8명, V&F: 6명, P&F: 5명
- P&V&F: 3명
  적어도 하나의 악기를 연주하는 학생 수는?

$$ n(P \cup V \cup F) = (20 + 15 + 10) - (8 + 6 + 5) + 3 $$
$$ = 45 - 19 + 3 = 29 \text{명} $$

### 예제 2: 배수 문제 (Divisibility)

1부터 30까지의 정수 중 2, 3, 5 중 적어도 하나로 나누어떨어지는 수의 개수는?

- **1개씩:** $n(2)=15, n(3)=10, n(5)=6 \rightarrow \text{합 } 31$
- **2개씩 (최소공배수):** $n(6)=5, n(10)=3, n(15)=2 \rightarrow \text{합 } 10$
- **3개씩 (최소공배수):** $n(30)=1 \rightarrow \text{합 } 1$
- **계산:** $31 - 10 + 1 = 22$개

## 4. 코드 구현 (Code Implementation)

Python을 사용하여 3개 집합의 PIE 공식을 계산하고, 집합(Set) 연산을 통해 이를 검증합니다.

```python
def solve_three_set_pie(nA, nB, nC, nAB, nAC, nBC, nABC):
    """
    3집합 PIE 공식 적용
    """
    single_sum = nA + nB + nC
    double_sum = nAB + nAC + nBC
    triple_sum = nABC

    return single_sum - double_sum + triple_sum

def verify_divisibility_example():
    # 예제 2: 1~30 중 2, 3, 5의 배수 개수 검증
    universe = set(range(1, 31))

    A = {x for x in universe if x % 2 == 0}
    B = {x for x in universe if x % 3 == 0}
    C = {x for x in universe if x % 5 == 0}

    # 1. 실제 합집합 (Python Set)
    actual_union = len(A | B | C)

    # 2. PIE 공식 계산
    nAB = len(A & B)
    nAC = len(A & C)
    nBC = len(B & C)
    nABC = len(A & B & C)

    calculated_union = solve_three_set_pie(len(A), len(B), len(C), nAB, nAC, nBC, nABC)

    print(f"실제 합집합 크기: {actual_union}")      # Expected: 22
    print(f"PIE 공식 계산값: {calculated_union}")  # Expected: 22
    print(f"검증 결과: {actual_union == calculated_union}")

verify_divisibility_example()
```

## 5. 요약 (Summary)

- **패턴:** 더하고($+$), 빼고($-$), 더한다($+$). (홀수 개는 더하고 짝수 개는 뺌)
- **가운데 영역:** 3번 더하고 3번 뺐으므로 0이 되어, 마지막에 반드시 한 번 더해줘야 함을 기억해야 합니다.
- **확장:** 전체 집합 $U$가 주어졌을 때, "아무것도 해당하지 않는(Neither)" 경우는 $n(U) - n(A \cup B \cup C)$로 구합니다.
