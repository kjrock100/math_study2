# 9.3 격자 속 직사각형의 개수 (Number of Rectangles in Grid)

## 1. 개요 (Overview)

격자(Grid)에서 직사각형의 개수를 세는 문제는 정사각형 개수 세기보다 훨씬 간단한 조합론적 원리를 따릅니다. 직사각형은 **가로선 2개**와 **세로선 2개**가 만나서 만들어진다는 점에 착안하여 조합(Combinations) 공식을 사용합니다.

## 2. 공식 및 원리 (Formula & Principle)

### 2.1 기본 원리

$m \times n$ 격자(칸 수 기준)가 있을 때:

- 가로선(Horizontal Lines)의 개수: $m + 1$개
- 세로선(Vertical Lines)의 개수: $n + 1$개

직사각형 하나를 결정하기 위해서는 가로선 중 2개를 선택하고, 세로선 중 2개를 선택하면 됩니다.

### 2.2 공식

$$ \text{Total Rectangles} = \binom{m+1}{2} \times \binom{n+1}{2} $$

이를 수식으로 풀면 다음과 같습니다:
$$ \frac{m(m+1)}{2} \times \frac{n(n+1)}{2} $$

즉, (1부터 $m$까지의 합) $\times$ (1부터 $n$까지의 합)과 같습니다.

## 3. 정사각형이 아닌 직사각형 (Non-Square Rectangles)

문제에서 "정사각형이 아닌 직사각형(Rectangles that are not squares)"의 개수를 묻는 경우가 많습니다.

$$ \text{Non-Square Rectangles} = \text{Total Rectangles} - \text{Total Squares} $$

- **Total Rectangles:** $\binom{m+1}{2} \times \binom{n+1}{2}$
- **Total Squares:** $\sum_{k=1}^{\min(m,n)} (m-k+1)(n-k+1)$ (9.2장 참조)

## 4. 예제 (Examples)

### 예제 1: $3 \times 4$ 격자

세로 3칸, 가로 4칸인 격자에서 직사각형의 개수는?

- 가로선: 4개 $\rightarrow \binom{4}{2} = 6$
- 세로선: 5개 $\rightarrow \binom{5}{2} = 10$
- **총 개수:** $6 \times 10 = 60$개

### 예제 2: 정사각형이 아닌 직사각형 ($2 \times 3$)

$2 \times 3$ 격자에서 정사각형이 아닌 직사각형의 개수는?

1.  **전체 직사각형:**
    - 가로선 3개($\binom{3}{2}=3$), 세로선 4개($\binom{4}{2}=6$)
    - $3 \times 6 = 18$개
2.  **정사각형 개수:**
    - $1 \times 1$: $2 \times 3 = 6$개
    - $2 \times 2$: $1 \times 2 = 2$개
    - 합: $8$개
3.  **정답:** $18 - 8 = 10$개

## 5. 코드 구현 (Code Implementation)

Python을 사용하여 직사각형 개수와 정사각형이 아닌 직사각형 개수를 계산하는 함수입니다.

```python
import math

def count_rectangles_analysis(m, n):
    """
    m x n 격자에서 직사각형 분석 (전체, 정사각형, 정사각형 아님)
    """
    # 1. 전체 직사각형 개수 (Combinations)
    horizontal_choices = math.comb(m + 1, 2)
    vertical_choices = math.comb(n + 1, 2)
    total_rects = horizontal_choices * vertical_choices

    # 2. 정사각형 개수 (Summation)
    min_side = min(m, n)
    total_squares = 0
    for k in range(1, min_side + 1):
        total_squares += (m - k + 1) * (n - k + 1)

    # 3. 정사각형이 아닌 직사각형
    non_squares = total_rects - total_squares

    return total_rects, total_squares, non_squares

# 테스트: 3x4 격자
rects, squares, non_sq = count_rectangles_analysis(3, 4)
print(f"3x4 Grid Analysis:")
print(f"- 전체 직사각형: {rects}")        # Expected: 60
print(f"- 정사각형: {squares}")            # Expected: 1*2 + 2*3 + 3*4 = 2+6+12 = 20
print(f"- 정사각형 아님: {non_sq}")        # Expected: 40
```

## 6. 요약 (Summary)

- **직사각형 공식:** $\binom{m+1}{2} \times \binom{n+1}{2}$.
- **원리:** 가로선 2개와 세로선 2개를 선택하면 직사각형 하나가 정의된다.
- **응용:** 정사각형이 아닌 것을 구할 때는 전체에서 정사각형 개수(9.2장)를 뺀다.
