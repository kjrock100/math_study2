# 3.8.2 PIE for Multisets 분석

이 문서는 **3.8.2 PIE for Multisets** 섹션의 내용을 분석하고 설명합니다. 이 섹션은 중복 조합(Multiset Counting) 문제에서 변수에 **상한(Upper Bound)** 제약 조건이 있을 때, 포함-배제의 원리(PIE)를 사용하여 해의 개수를 구하는 방법을 다룹니다.

## 1. 섹션 개요 (Overview)

우리는 3.5절에서 $x_1 + x_2 + \dots + x_k = n$ ($x_i \ge 0$) 형태의 방정식의 해를 구하는 법(Stars and Bars)을 배웠습니다. 하지만 현실적인 문제에서는 "쿠키를 10개 이상 먹으면 안 된다"와 같은 상한선이 존재합니다. 이 섹션에서는 이러한 제약 조건을 **"위반하는 경우를 전체에서 뺀다"**는 전략으로 해결합니다.

## 2. 기본 도구 복습

* **기본 문제:** $x_1 + \dots + x_k = n$ ($x_i \ge 0$)
* **해결:** $\binom{n+k-1}{k-1}$ (또는 $\binom{n+k-1}{n}$)

## 3. 상한 제약 조건 처리 (Handling Upper Bounds)

### 3.1 문제 정의

방정식 $x_1 + x_2 + x_3 = 10$의 해를 구하되, $0 \le x_i \le 4$인 조건을 만족해야 합니다.

### 3.2 PIE 적용 전략

직접 세는 것은 어렵습니다. 대신 전체에서 조건을 위반하는 경우를 뺍니다.

1. **전체 집합 ($S$):** 제약 조건 없이 $x_i \ge 0$인 모든 해의 집합.
    * $|S| = \binom{10+3-1}{3-1} = \binom{12}{2} = 66$.
2. **조건 위반 ($A_i$):** 변수 $x_i$가 상한을 넘는 경우, 즉 $x_i \ge 5$.
    * 우리가 구하고자 하는 것은 $|S| - |A_1 \cup A_2 \cup A_3|$ 입니다.

### 3.3 위반 사례 계산

$x_1 \ge 5$인 해의 개수($|A_1|$)는 어떻게 구할까요?

* **모델링:** $x_1$에 미리 5를 할당합니다. ($x_1' = x_1 - 5 \ge 0$)
* **변환된 방정식:** $x_1' + x_2 + x_3 = 10 - 5 = 5$.
* **계산:** $\binom{5+3-1}{2} = \binom{7}{2} = 21$.
* 대칭성에 의해 $|A_1| = |A_2| = |A_3| = 21$.

### 3.4 교집합 계산 (중복 위반)

두 변수가 동시에 상한을 넘는 경우($A_1 \cap A_2$)도 고려해야 합니다.

* $x_1 \ge 5$ 이고 $x_2 \ge 5$.
* 미리 5씩 할당하면 총 10이 빠집니다.
* **변환된 방정식:** $x_1' + x_2' + x_3 = 10 - 5 - 5 = 0$.
* **계산:** $\binom{0+3-1}{2} = \binom{2}{2} = 1$.
* 세 변수가 모두 넘는 경우($A_1 \cap A_2 \cap A_3$)는 합이 15가 되어야 하므로 불가능(0)합니다.

### 3.5 최종 계산

$$
\begin{aligned}
\text{Valid Solutions} &= |S| - (|A_1| + |A_2| + |A_3|) + (|A_1 \cap A_2| + \dots) - \dots \\
&= 66 - (21 + 21 + 21) + (1 + 1 + 1) - 0 \\
&= 66 - 63 + 3 \\
&= 6
\end{aligned}
$$

## 4. 요약

**3.8.2 PIE for Multisets**는 중복 조합 문제의 난이도를 한 단계 높입니다.

* **하한($\ge$)**은 미리 나누어 주는 것으로 쉽게 해결되지만,
* **상한($\le$)**은 PIE를 사용하여 "위반하는 경우"를 제거하는 방식으로 해결해야 합니다.
